<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>smallsh: include/events/sender.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">smallsh
   &#160;<span id="projectnumber">1.0.0</span>
   </div>
   <div id="projectbrief">Simple implementation of a Linux shell written in C.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="dir_c33611b4dec78f96017d2ccf425d656a.html">events</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">sender.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Responsible for sending messages to subscribers via a dedicated <a class="el" href="structChannel.html" title="A Channel object consists of a read end and a write end, as well as a callback handler function that ...">Channel</a>.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="channel_8h_source.html">channel.h</a>&quot;</code><br />
</div>
<p><a href="sender_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structSender.html">Sender</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">A <code><a class="el" href="structSender.html" title="A Sender object consists of an array of Channels that it is responsible for sending messages to on re...">Sender</a></code> object consists of an array of <code>Channels</code> that it is responsible for sending messages to on receipt of signal-generated events.  <a href="structSender.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aab863276e1e12ef4b211877c91e11acb"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sender_8h.html#aab863276e1e12ef4b211877c91e11acb">sender_add</a> (<a class="el" href="structSender.html">Sender</a> *self, <a class="el" href="structChannel.html">Channel</a> *ch)</td></tr>
<tr class="memdesc:aab863276e1e12ef4b211877c91e11acb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds a new <code><a class="el" href="structChannel.html" title="A Channel object consists of a read end and a write end, as well as a callback handler function that ...">Channel</a></code> to its channel list, and initializes its write end.  <a href="sender_8h.html#aab863276e1e12ef4b211877c91e11acb">More...</a><br /></td></tr>
<tr class="separator:aab863276e1e12ef4b211877c91e11acb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0641c6a72fb9606c6e93200fb13098d1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sender_8h.html#a0641c6a72fb9606c6e93200fb13098d1">sender_ctor</a> (<a class="el" href="structSender.html">Sender</a> *self, size_t max_ch)</td></tr>
<tr class="memdesc:a0641c6a72fb9606c6e93200fb13098d1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes <code>self</code> with provided data.  <a href="sender_8h.html#a0641c6a72fb9606c6e93200fb13098d1">More...</a><br /></td></tr>
<tr class="separator:a0641c6a72fb9606c6e93200fb13098d1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a533a37ce0fc01b242ac7f143d4fb106a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sender_8h.html#a533a37ce0fc01b242ac7f143d4fb106a">sender_dtor</a> (<a class="el" href="structSender.html">Sender</a> *self)</td></tr>
<tr class="memdesc:a533a37ce0fc01b242ac7f143d4fb106a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resets <code>self's</code> values.  <a href="sender_8h.html#a533a37ce0fc01b242ac7f143d4fb106a">More...</a><br /></td></tr>
<tr class="separator:a533a37ce0fc01b242ac7f143d4fb106a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a480b90bd37ac42bd758e2c7782183618"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sender_8h.html#a480b90bd37ac42bd758e2c7782183618">sender_notify_sigchld</a> (struct <a class="el" href="structChannel.html">Channel</a> ch)</td></tr>
<tr class="memdesc:a480b90bd37ac42bd758e2c7782183618"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sends data received via a SIGCHLD signal to <code>self</code>.  <a href="sender_8h.html#a480b90bd37ac42bd758e2c7782183618">More...</a><br /></td></tr>
<tr class="separator:a480b90bd37ac42bd758e2c7782183618"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Responsible for sending messages to subscribers via a dedicated <a class="el" href="structChannel.html" title="A Channel object consists of a read end and a write end, as well as a callback handler function that ...">Channel</a>. </p>
<dl class="section author"><dt>Author</dt><dd>Mohamed Al-Hussein </dd></dl>
<dl class="section date"><dt>Date</dt><dd>09 Feb 2022 </dd></dl>

<p class="definition">Definition in file <a class="el" href="sender_8h_source.html">sender.h</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="aab863276e1e12ef4b211877c91e11acb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aab863276e1e12ef4b211877c91e11acb">&#9670;&nbsp;</a></span>sender_add()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sender_add </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSender.html">Sender</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structChannel.html">Channel</a> *&#160;</td>
          <td class="paramname"><em>ch</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adds a new <code><a class="el" href="structChannel.html" title="A Channel object consists of a read end and a write end, as well as a callback handler function that ...">Channel</a></code> to its channel list, and initializes its write end. </p>
<p>Behind the scenes, this function initializes the channel pipe's write end and sets it to be non-blocking as per the self-pipe trick requirements. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">self</td><td><code><a class="el" href="structSender.html" title="A Sender object consists of an array of Channels that it is responsible for sending messages to on re...">Sender</a></code> to add channel to </td></tr>
    <tr><td class="paramname">ch</td><td><code><a class="el" href="structChannel.html" title="A Channel object consists of a read end and a write end, as well as a callback handler function that ...">Channel</a></code> to add to sender </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 on failure </dd></dl>

<p class="definition">Definition at line <a class="el" href="sender_8c_source.html#l00088">88</a> of file <a class="el" href="sender_8c_source.html">sender.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;{</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="keywordtype">int</span> flags, <a class="code" href="status_8h.html#a685506d2c432425b89581f85cf876f22">status</a>;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160; </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <span class="comment">/* Set write end to non-blocking. */</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;        errno = 0;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        flags = fcntl(ch-&gt;<a class="code" href="structChannel.html#ad874d338cec1167c20e7e503f50a212d">ch_write</a>, F_GETFL);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="keywordflow">if</span> (flags == -1) {</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                fprintf(stderr, <span class="stringliteral">&quot;Failed to add to Sender: %s\n&quot;</span>, strerror(errno));</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        }</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        flags |= O_NONBLOCK;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160; </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;        errno = 0;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <a class="code" href="status_8h.html#a685506d2c432425b89581f85cf876f22">status</a> = fcntl(ch-&gt;<a class="code" href="structChannel.html#ad874d338cec1167c20e7e503f50a212d">ch_write</a>, F_SETFL, flags);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="status_8h.html#a685506d2c432425b89581f85cf876f22">status</a> == -1) {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                fprintf(stderr, <span class="stringliteral">&quot;Failed to add to Sender: %s\n&quot;</span>, strerror(errno));</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        }</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160; </div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="comment">/* Add channel to channel list. */</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="keywordflow">if</span> (self-&gt;<a class="code" href="structSender.html#ab060d64177bbbfd3aae6185c955b04a8">_snd_n_ch</a> &gt;= self-&gt;<a class="code" href="structSender.html#a5ff9371d6791fa752e1030ad16345405">_snd_max_ch</a>) {</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                fprintf(stderr, <span class="stringliteral">&quot;Failed to add to Sender: Sender is full\n&quot;</span>);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        }</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; </div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;        <span class="keyword">self</span>-&gt;_ch[<span class="keyword">self</span>-&gt;_snd_n_ch++] = ch;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160; </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="channel_8h_source.html#l00017">Channel::ch_write</a>, and <a class="el" href="status_8c_source.html#l00043">status()</a>.</p>

<p class="reference">Referenced by <a class="el" href="events_8c_source.html#l00042">events_init()</a>.</p>

</div>
</div>
<a id="a0641c6a72fb9606c6e93200fb13098d1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0641c6a72fb9606c6e93200fb13098d1">&#9670;&nbsp;</a></span>sender_ctor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sender_ctor </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSender.html">Sender</a> *&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>max_ch</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes <code>self</code> with provided data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">self</td><td><code><a class="el" href="structSender.html" title="A Sender object consists of an array of Channels that it is responsible for sending messages to on re...">Sender</a></code> to initialize </td></tr>
    <tr><td class="paramname">max_ch</td><td>maximum number of channels sender will support </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 on failure </dd></dl>

<p class="definition">Definition at line <a class="el" href="sender_8c_source.html#l00048">48</a> of file <a class="el" href="sender_8c_source.html">sender.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;{</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <span class="keyword">self</span>-&gt;_snd_n_ch = 0;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        <span class="keyword">self</span>-&gt;_snd_max_ch = max_ch;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160; </div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        <span class="comment">/* Init Channel array. */</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        <span class="keyword">self</span>-&gt;_ch = malloc(max_ch * <span class="keyword">sizeof</span>(<a class="code" href="structChannel.html">Channel</a>));</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        <span class="keywordflow">if</span> (self-&gt;<a class="code" href="structSender.html#af77d61fad8e4c1c1b51894f3582c3c0f">_ch</a> == NULL) {</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                fprintf(stderr, <span class="stringliteral">&quot;Failed to init Sender: malloc()\n&quot;</span>);</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        }</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; max_ch; i++) {</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                <span class="keyword">self</span>-&gt;_ch[i] = NULL;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        }</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="events_8c_source.html#l00042">events_init()</a>.</p>

</div>
</div>
<a id="a533a37ce0fc01b242ac7f143d4fb106a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a533a37ce0fc01b242ac7f143d4fb106a">&#9670;&nbsp;</a></span>sender_dtor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sender_dtor </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structSender.html">Sender</a> *&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Resets <code>self's</code> values. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">self</td><td><code><a class="el" href="structSender.html" title="A Sender object consists of an array of Channels that it is responsible for sending messages to on re...">Sender</a></code> to reset </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This does not clear the actual channels by calling their respective destructors. It is the caller's responsibility to do so afterwards. </dd></dl>

<p class="definition">Definition at line <a class="el" href="sender_8c_source.html#l00067">67</a> of file <a class="el" href="sender_8c_source.html">sender.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;{</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <span class="keyword">self</span>-&gt;_snd_n_ch; i++) {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                <span class="keyword">self</span>-&gt;_ch[i] = NULL;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        }</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="keyword">self</span>-&gt;_snd_n_ch = 0;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160; </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        free(self-&gt;<a class="code" href="structSender.html#af77d61fad8e4c1c1b51894f3582c3c0f">_ch</a>);</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="keyword">self</span>-&gt;_ch = NULL;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="events_8c_source.html#l00082">events_cleanup()</a>.</p>

</div>
</div>
<a id="a480b90bd37ac42bd758e2c7782183618"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a480b90bd37ac42bd758e2c7782183618">&#9670;&nbsp;</a></span>sender_notify_sigchld()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sender_notify_sigchld </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structChannel.html">Channel</a>&#160;</td>
          <td class="paramname"><em>ch</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sends data received via a SIGCHLD signal to <code>self</code>. </p>
<p>This function abstracts the signal-handling step used in the self-pipe trick (TLPI section 63.5.2) in an attempt to relay SIGCHLD data while doing its best at remaining async-safe.</p>
<p>Only async-safe system calls are made within this function, and the only global data type that is being accessed within is the pipe's write file descriptor, which is done so for reads only, and without any dereferences. The file descriptor is initialized on program startup, and remains unchanged until program termination.</p>
<p>The data sent is used for updating the shell's global job table, as it requires information on both which child completed and what their exit status was. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ch</td><td><code><a class="el" href="structChannel.html" title="A Channel object consists of a read end and a write end, as well as a callback handler function that ...">Channel</a></code> to send data to </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>0 on success, -1 on failure </dd></dl>

<p class="definition">Definition at line <a class="el" href="sender_8c_source.html#l00119">119</a> of file <a class="el" href="sender_8c_source.html">sender.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;{</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        <span class="keywordtype">int</span> <a class="code" href="status_8h.html#a685506d2c432425b89581f85cf876f22">status</a>;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        pid_t child_pid;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <a class="code" href="structSigchldDTO.html">SigchldDTO</a> dto;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160; </div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">         * Catch all incoming SIGCHLD signals and dispatch their status to</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">         * listening parties.</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">         *</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">         * Source: TLPI section 26.3</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        errno = 0;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <span class="keywordflow">while</span> ((child_pid = waitpid(-1, &amp;<a class="code" href="status_8h.html#a685506d2c432425b89581f85cf876f22">status</a>, WNOHANG)) &gt; 0) {</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                <span class="comment">/* Initialize DTO object to transfer PID and status through. */</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                dto.<a class="code" href="structSigchldDTO.html#a4a3b6d71f036c6b8f9cc0e07287307f7">chld_pid</a> = child_pid;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                dto.<a class="code" href="structSigchldDTO.html#a6a444cc7e2b4feea515de9823d2858ce">chld_status</a> = <a class="code" href="status_8h.html#a685506d2c432425b89581f85cf876f22">status</a>;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160; </div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                <span class="comment">/* Write DTO to pipe. */</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                errno = 0;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                <span class="keywordflow">if</span> (write(ch.<a class="code" href="structChannel.html#ad874d338cec1167c20e7e503f50a212d">ch_write</a>, &amp;dto, <span class="keyword">sizeof</span>(dto)) == -1 &amp;&amp; errno != EAGAIN) {</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                        <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        }</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="keywordflow">if</span> (child_pid == -1 &amp;&amp; errno != ECHILD) {</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        }</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160; </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="channel_8h_source.html#l00017">Channel::ch_write</a>, <a class="el" href="dto_8h_source.html#l00018">SigchldDTO::chld_pid</a>, <a class="el" href="dto_8h_source.html#l00019">SigchldDTO::chld_status</a>, and <a class="el" href="status_8c_source.html#l00043">status()</a>.</p>

<p class="reference">Referenced by <a class="el" href="handler_8c_source.html#l00151">handler_handle_sigchld()</a>.</p>

</div>
</div>
</div><!-- contents -->
<div class="ttc" id="astructChannel_html"><div class="ttname"><a href="structChannel.html">Channel</a></div><div class="ttdoc">A Channel object consists of a read end and a write end, as well as a callback handler function that ...</div><div class="ttdef"><b>Definition:</b> <a href="channel_8h_source.html#l00015">channel.h:15</a></div></div>
<div class="ttc" id="astructSender_html_ab060d64177bbbfd3aae6185c955b04a8"><div class="ttname"><a href="structSender.html#ab060d64177bbbfd3aae6185c955b04a8">Sender::_snd_n_ch</a></div><div class="ttdeci">size_t _snd_n_ch</div><div class="ttdef"><b>Definition:</b> <a href="sender_8h_source.html#l00017">sender.h:17</a></div></div>
<div class="ttc" id="astructSigchldDTO_html_a6a444cc7e2b4feea515de9823d2858ce"><div class="ttname"><a href="structSigchldDTO.html#a6a444cc7e2b4feea515de9823d2858ce">SigchldDTO::chld_status</a></div><div class="ttdeci">int chld_status</div><div class="ttdef"><b>Definition:</b> <a href="dto_8h_source.html#l00019">dto.h:19</a></div></div>
<div class="ttc" id="astructSigchldDTO_html_a4a3b6d71f036c6b8f9cc0e07287307f7"><div class="ttname"><a href="structSigchldDTO.html#a4a3b6d71f036c6b8f9cc0e07287307f7">SigchldDTO::chld_pid</a></div><div class="ttdeci">pid_t chld_pid</div><div class="ttdef"><b>Definition:</b> <a href="dto_8h_source.html#l00018">dto.h:18</a></div></div>
<div class="ttc" id="astructChannel_html_ad874d338cec1167c20e7e503f50a212d"><div class="ttname"><a href="structChannel.html#ad874d338cec1167c20e7e503f50a212d">Channel::ch_write</a></div><div class="ttdeci">int ch_write</div><div class="ttdef"><b>Definition:</b> <a href="channel_8h_source.html#l00017">channel.h:17</a></div></div>
<div class="ttc" id="astructSender_html_af77d61fad8e4c1c1b51894f3582c3c0f"><div class="ttname"><a href="structSender.html#af77d61fad8e4c1c1b51894f3582c3c0f">Sender::_ch</a></div><div class="ttdeci">Channel ** _ch</div><div class="ttdef"><b>Definition:</b> <a href="sender_8h_source.html#l00019">sender.h:19</a></div></div>
<div class="ttc" id="astructSender_html_a5ff9371d6791fa752e1030ad16345405"><div class="ttname"><a href="structSender.html#a5ff9371d6791fa752e1030ad16345405">Sender::_snd_max_ch</a></div><div class="ttdeci">size_t _snd_max_ch</div><div class="ttdef"><b>Definition:</b> <a href="sender_8h_source.html#l00018">sender.h:18</a></div></div>
<div class="ttc" id="astructSigchldDTO_html"><div class="ttname"><a href="structSigchldDTO.html">SigchldDTO</a></div><div class="ttdoc">A SigchldDTO contains relevant data about a SIGCHLD event that the global job table will use to updat...</div><div class="ttdef"><b>Definition:</b> <a href="dto_8h_source.html#l00017">dto.h:17</a></div></div>
<div class="ttc" id="astatus_8h_html_a685506d2c432425b89581f85cf876f22"><div class="ttname"><a href="status_8h.html#a685506d2c432425b89581f85cf876f22">status</a></div><div class="ttdeci">void status(void)</div><div class="ttdoc">Displays last exit status value to user.</div><div class="ttdef"><b>Definition:</b> <a href="status_8c_source.html#l00043">status.c:43</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
